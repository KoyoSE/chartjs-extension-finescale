/* !
 * chartjs-extension-finescale.js
 *
 * Version: 0.0.1
 *
 * chartjs-extension-finescale.js Copyright 2016 koyoSE
 * Released under the MIT license
 * https://github.com/KoyoSE/chartjs-extension-finescale.git
 *
 * Chart.js Copyright 2016 Nick Downie
 * Released under the MIT license
 * https://github.com/chartjs/Chart.js/blob/master/LICENSE.md
 */
!function i(t,e,l){function a(o,r){if(!e[o]){if(!t[o]){var n="function"==typeof require&&require;if(!r&&n)return n(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=e[o]={exports:{}};t[o][0].call(d.exports,function(i){var e=t[o][1][i];return a(e?e:i)},d,d.exports,i,t,e,l)}return e[o].exports}for(var s="function"==typeof require&&require,o=0;o<l.length;o++)a(l[o]);return a}({1:[function(i,t,e){i(2)(Chart)},{2:2}],2:[function(i,t,e){t.exports=function(i){"use strict";var t=i.helpers,e={position:"left",subScale:{display:!0,ticks:{display:!0,fontSize:11},gridLines:{display:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.07)"},subScale:{display:!0,ticks:{display:!1,fontSize:10},gridLines:{display:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.03)"}}}},l=i.scaleService.getScaleConstructor("linear").extend({niceNum:function(i,e){var l,a=Math.floor(t.log10(i)),s=i/Math.pow(10,a);return l=e?s<=1?5:s<=5?10:20:s<=1?1:s<=2?2:s<=5?5:10,l*Math.pow(10,a)},getDicimalDigits:function(i){i=0===i?1:i;var e=Math.floor(t.log10(i));return{digits:e>0?0:Math.abs(e),magnification:Math.pow(10,e)}},getLevel:function(i,t,e){var l=i/e%(t[0]/e),a=i/e%(t[1]/e);return 0===l?0:0===a?1:2},fineLinear:function(i,t){var e=this,l=[],a=[],s=[],o=[],r=[e.options.ticks,e.options.subScale.ticks,e.options.subScale.subScale.ticks],n=e.niceNum(t.max-t.min,!1),c=[];c[0]=e.niceNum(n/(i.maxTicks-1),!0),c[1]=e.niceNum(c[0]/10,!0),c[2]=e.niceNum(c[1]/10,!0);var d=2;if(i.stepSize&&i.stepSize>0){for(var f=i.stepSize,g=0;g<e.levelMax;g++)c[g]<=i.stepSize&&(c[g]=f,d=0!==f?g:d,f=0);c[d]=c[d]>i.stepSize?i.stepSize:c[d]}var p,u,h=Math.floor(t.min/c[0])*c[0],k=Math.ceil(t.max/c[0])*c[0],m=void 0!==i.min?i.min:h,x=void 0!==i.max?i.max:k,v=[e.getDicimalDigits(c[0]),e.getDicimalDigits(c[1]),e.getDicimalDigits(c[2])],T=+((k-h)/c[d]).toFixed(v[d].digits);l.push(m),a.push(e.getLevel(m,c,v[d].magnification));for(var y=1;y<T;++y)u=h+ +(y*c[d]).toFixed(v[d].digits),u<=m||x<=u||(p=e.getLevel(u,c,v[d].magnification),l.push(+u.toFixed(v[p].digits)),a.push(p));l.push(x),a.push(e.getLevel(x,c,v[d].magnification));var b;for(y=0;y<l.length;y++)b=0===y||(y===l.length-1||!!r[a[y]].display),s.push(b),b&&o.push(l[y]);return{ticks:l,levels:a,min:m,max:x,isDisplayTicks:s,displayTicks:o}},ticksReverse:function(){var i=this;i.ticks.reverse(),i.tickLevels.reverse(),i.isDisplayTicks.reverse(),i.displayTicks.reverse()},handleDirectionalChanges:function(){var i=this;i.isHorizontal()||i.ticksReverse()},getTickLimit:function(){var e,l=this,a=l.options.ticks;if(l.isHorizontal())e=Math.min(a.maxTicksLimit?a.maxTicksLimit:11,Math.ceil(l.width/50));else{var s=t.getValueOrDefault(a.fontSize,i.defaults.global.defaultFontSize);e=Math.min(a.maxTicksLimit?a.maxTicksLimit:11,Math.ceil(l.height/(1.5*s)))}return e},buildTicks:function(){var i=this;i.levelMax=3;var e=i.options,l=[e.ticks,e.subScale.ticks,e.subScale.subScale.ticks],a=i.getTickLimit();a=Math.max(2,a);var s={maxTicks:a,min:l[0].min,max:l[0].max,stepSize:t.getValueOrDefault(l[0].fixedStepSize,l[0].stepSize)},o=i.fineLinear(s,i);i.ticks=o.ticks,i.tickLevels=o.levels,i.isDisplayTicks=o.isDisplayTicks,i.displayTicks=o.displayTicks,i.handleDirectionalChanges(),i.max=o.max,i.min=o.min,l[0].reverse?(i.ticksReverse(),i.start=i.max,i.end=i.min):(i.start=i.min,i.end=i.max)},computeTextSize:function(i,e,l){return t.isArray(e)?t.longestText(i,l,e):i.measureText(e).width},parseFontOptions:function(e){var l=t.getValueOrDefault,a=i.defaults.global,s=l(e.fontSize,a.defaultFontSize),o=l(e.fontStyle,a.defaultFontStyle),r=l(e.fontFamily,a.defaultFontFamily);return{size:s,style:o,family:r,font:t.fontString(s,o,r)}},draw:function(e){var l=this,a=[l.options,l.options.subScale,l.options.subScale.subScale];if(a[0].display){var s,o=l.ctx,r=i.defaults.global,n=[a[0].ticks,a[1].ticks,a[2].ticks],c=[a[0].gridLines,a[1].gridLines,a[2].gridLines],d=[a[0].scaleLabel,a[1].scaleLabel,a[2].scaleLabel];n[0].maxTicksLimit&&(s=n[0].maxTicksLimit);var f,g=[l.parseFontOptions(n[0]),l.parseFontOptions(n[1]),l.parseFontOptions(n[2])],p=c[0].drawTicks?[c[0].tickMarkLength,c[1].drawTicks?c[1].tickMarkLength||.6*c[0].tickMarkLength:0,c[2].drawTicks?c[2].tickMarkLength||.4*c[0].tickMarkLength:0]:[0,0,0],u=[],h=t.getValueOrDefault(d[0].fontColor,r.defaultFontColor),k=l.parseFontOptions(d[0]),m=0!==l.labelRotation,x=n[0].autoSkip,v=l.isHorizontal(),T=t.toRadians(l.labelRotation),y=Math.cos(T),b=l.longestLabelWidth*y;if(v){if(f=!1,m&&(b/=2),(b+n[0].autoSkipPadding)*l.ticks.length>l.width-(l.paddingLeft+l.paddingRight)&&(f=1+Math.floor((b+n[0].autoSkipPadding)*l.ticks.length/(l.width-(l.paddingLeft+l.paddingRight)))),s&&l.ticks.length>s)for(;!f||l.ticks.length/(f||1)>s;)f||(f=1),f+=1;x||(f=!1)}if(t.each(l.ticks,function(i,s){if(void 0!==i&&null!==i){var o=l.tickLevels[s];if(a[o].display){var d=l.ticks.length===s+1,g=f>1&&s%f>0||s%f===0&&s+f>=l.ticks.length;if((!g||d)&&void 0!==i&&null!==i){var h,k,x=t.getValueOrDefault(c[o].borderDash,c[0].borderDash),y=t.getValueOrDefault(c[o].borderDashOffset,c[0].borderDashOffset),b=t.getValueOrDefault(c[o].drawOnChartArea,c[0].drawOnChartArea),D=!!c[0].display&&c[o].display,S=!!c[0].drawTicks&&c[o].drawTicks;s===("undefined"!=typeof l.zeroLineIndex?l.zeroLineIndex:0)?(h=c[0].zeroLineWidth,k=c[0].zeroLineColor):(h=t.isArray(c[0].lineWidth)?t.getValueAtIndexOrDefault(c[0].lineWidth,s):t.getValueAtIndexOrDefault(c[o].lineWidth,s,c[0].lineWidth),k=t.isArray(c[0].color)?t.getValueAtIndexOrDefault(c[0].color,s):t.getValueAtIndexOrDefault(c[o].color,s,c[0].color));var L,O,z,F,M,w,V,P,C,A,R="middle",W="middle";if(v){"bottom"===a[0].position?(W="top",R=m?"right":"center",A=m?l.top+p[0]:l.top+p[o]):(W="bottom",R=m?"left":"center",A=m?l.bottom-p[0]:l.bottom-p[o]),C=l.getPixelForTick(s,c[0].offsetGridLines)+n[0].labelOffset;var I=l.getPixelForTick(s)+t.aliasPixel(h),X="bottom"===a[0].position?l.top:l.bottom-p[o],Y="bottom"===a[0].position?l.top+p[o]:l.bottom;L=z=M=V=I,O=X,F=Y,w=e.top,P=e.bottom}else{var B,N="left"===a[0].position,H=n[0].padding;n[0].mirror?(R=N?"left":"right",B=H):(R=N?"right":"left",B=p[o]+H),C=N?l.right-B:l.left+B;var q=l.getPixelForTick(s);q+=t.aliasPixel(h),A=l.getPixelForTick(s,c[0].offsetGridLines);var E="right"===a[0].position?l.left:l.right-p[o],G="right"===a[0].position?l.left+p[o]:l.right;L=E,z=G,M=e.left,V=e.right,O=F=w=P=q}u.push({display:D,level:o,tlDraw:S,tlX1:L,tlY1:O,tlX2:z,tlY2:F,tlColor:c[0].color,glDraw:b,glX1:M,glY1:w,glX2:V,glY2:P,glWidth:h,glColor:k,glBorderDash:x,glBorderDashOffset:y,lDisplay:l.isDisplayTicks[s],lX:C,lY:A,label:i,lRotation:-1*T,lTextBaseline:W,lTextAlign:R,lFontColor:t.getValueOrDefault(n[o].fontColor,r.defaultFontColor)})}}}}),t.each(u,function(i){if(i.display&&(o.save(),o.lineWidth=i.glWidth,o.strokeStyle=i.tlColor,o.beginPath(),i.tlDraw&&(o.moveTo(i.tlX1,i.tlY1),o.lineTo(i.tlX2,i.tlY2)),o.stroke(),o.strokeStyle=i.glColor,o.setLineDash&&(o.setLineDash(i.glBorderDash),o.lineDashOffset=i.glBorderDashOffset),i.glDraw&&(o.moveTo(i.glX1,i.glY1),o.lineTo(i.glX2,i.glY2)),o.stroke(),o.restore()),i.lDisplay){o.save(),o.translate(i.lX,i.lY),o.rotate(i.lRotation),o.font=g[i.level].font,o.fillStyle=i.lFontColor,o.textBaseline=i.lTextBaseline,o.textAlign=i.lTextAlign;var e=i.label;if(t.isArray(e))for(var l=0,a=0;l<e.length;++l)o.fillText(""+e[l],0,a),a+=1.5*g[i.level].size;else o.fillText(e,0,0);o.restore()}}),d[0].display){var D,S,L=0;if(v)D=l.left+(l.right-l.left)/2,S="bottom"===a[0].position?l.bottom-k.size/2:l.top+k.size/2;else{var O="left"===a[0].position;D=O?l.left+k.size/2:l.right-k.size/2,S=l.top+(l.bottom-l.top)/2,L=O?-.5*Math.PI:-.5*Math.PI}o.save(),o.translate(D,S),o.rotate(L),o.textAlign="center",o.textBaseline="middle",o.fillStyle=h,o.font=k.font,o.fillText(d[0].labelString,0,0),o.restore()}if(c[0].drawBorder){o.lineWidth=t.getValueAtIndexOrDefault(c[0].lineWidth,0),o.strokeStyle=t.getValueAtIndexOrDefault(c[0].color,0);var z=l.left,F=l.right,M=l.top,w=l.bottom,V=t.aliasPixel(o.lineWidth);v?(M=w="top"===a[0].position?l.bottom:l.top,M+=V,w+=V):(z=F="left"===a[0].position?l.right:l.left,z+=V,F+=V),o.beginPath(),o.moveTo(z,M),o.lineTo(F,w),o.stroke()}}},calculateTickRotation:function(){var i=this,e=i.ctx,l=[i.options.ticks,i.options.subScale.ticks,i.options.subScale.subScale.ticks],a=i.parseFontOptions(l[0]),s=l[0].minRotation||0;if(i.options.display)if(i.isHorizontal()){for(var o,r,n=t.longestText(e,a.font,i.displayTicks,i.longestTextCache),c=n,d=i.getPixelForValue(i.displayTicks[1])-i.getPixelForValue(i.displayTicks[0])-6,f=i.getPixelForValue(i.displayTicks[i.displayTicks.length-1])-i.getPixelForValue(i.displayTicks[i.displayTicks.length-2])-6,g=Math.min(d,f);c>g&&s<l[0].maxRotation;){var p=t.toRadians(s);if(o=Math.cos(p),r=Math.sin(p),r*n>i.maxHeight){s--;break}s++,c=o*n}var u;p=t.toRadians(s),o=Math.cos(p),c=o*e.measureText(i.displayTicks[1]).width,void 0!==l[0].min&&d<c&&(u=i.ticks.indexOf(i.displayTicks[1].toString(10)),i.isDisplayTicks[u]=!1),c=o*e.measureText(i.displayTicks[i.isDisplayTicks.length-1]).width,void 0!==l[0].max&&f<c&&(u=i.ticks.indexOf(i.displayTicks[i.displayTicks.length-2].toString(10)),i.isDisplayTicks[u]=!1)}else{var h,k;h=i.getPixelForValue(i.displayTicks[1])-i.getPixelForValue(i.displayTicks[0]),k=Math.round(1.2*a.size),h<k&&(u=i.ticks.indexOf(i.displayTicks[1].toString(10)),i.isDisplayTicks[u]=!1),h=i.getPixelForValue(i.displayTicks[i.displayTicks.length-1])-i.getPixelForValue(i.displayTicks[i.displayTicks.length-2]),k=Math.round(1.2*a.size),h<k&&(u=i.ticks.indexOf(i.displayTicks[i.displayTicks.length-2].toString(10)),i.isDisplayTicks[u]=!1)}i.labelRotation=s}});i.scaleService.registerScaleType("fineLinear",l,e)}},{}]},{},[1]);