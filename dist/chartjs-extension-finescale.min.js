/* !
 * chartjs-extension-finescale.js
 *
 * Version: 0.0.1
 *
 * chartjs-extension-finescale.js Copyright 2016 koyoSE
 * Released under the MIT license
 * https://github.com/KoyoSE/chartjs-extension-finescale.git
 *
 * Chart.js Copyright 2016 Nick Downie
 * Released under the MIT license
 * https://github.com/chartjs/Chart.js/blob/master/LICENSE.md
 */
!function t(i,e,a){function s(o,n){if(!e[o]){if(!i[o]){var r="function"==typeof require&&require;if(!n&&r)return r(o,!0);if(l)return l(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=e[o]={exports:{}};i[o][0].call(f.exports,function(t){var e=i[o][1][t];return s(e?e:t)},f,f.exports,t,i,e,a)}return e[o].exports}for(var l="function"==typeof require&&require,o=0;o<a.length;o++)s(a[o]);return s}({1:[function(t,i,e){t(2)(Chart),t(3)(Chart),t(5)(Chart),t(4)(Chart)},{2:2,3:3,4:4,5:5}],2:[function(t,i,e){"use strict";i.exports=function(t){var i=t.helpers;t.FineScale={update:function(t,e,a){var s=this;return s.beforeUpdate(),s.maxWidth=t,s.maxHeight=e,s.margins=i.extend({left:0,right:0,top:0,bottom:0},a),s.longestTextCache=s.longestTextCache||{},s.beforeSetDimensions(),s.setDimensions(),s.afterSetDimensions(),s.beforeDataLimits(),s.determineDataLimits(),s.afterDataLimits(),s.beforeBuildTicks(),s.buildTicks(),s.generateTickDisplayPrameters(),s.afterBuildTicks(),s.beforeTickToLabelConversion(),s.convertTicksToLabels(),s.afterTickToLabelConversion(),s.beforeCalculateTickRotation(),s.calculateTickRotation(),s.afterCalculateTickRotation(),s.beforeFit(),s.fit(),s.afterFit(),s.afterUpdate(),s.minSize},generateTickDisplayPrameters:function(){var t=this,i=[t.options,t.options.subScale,t.options.subScale.subScale],e=[i[0].ticks,i[1].ticks,i[2].ticks];if(t.ticks||(t.ticks=[]),!t.tickLevels||t.ticks.length!==t.tickLevels.length){t.tickLevels=[];for(var a=0;a<t.ticks.length;a++)t.tickLevels.push(0)}var s,l=[],o=[];for(a=0;a<t.ticks.length;a++)s=0===a||(a===t.ticks.length-1||!!e[t.tickLevels[a]].display),l.push(s),s&&o.push(t.ticks[a]);t.isDisplayTicks=l,t.displayTicks=o},niceNum:function(t,e){var a,s=Math.floor(i.log10(t)),l=t/Math.pow(10,s);return a=e?l<=1?5:l<=5?10:20:l<=1?1:l<=2?2:l<=5?5:10,a*Math.pow(10,s)},computeTextSize:function(t,e,a){return i.isArray(e)?i.longestText(t,a,e):t.measureText(e).width},parseFontOptions:function(e){var a=i.getValueOrDefault,s=t.defaults.global,l=a(e.fontSize,s.defaultFontSize),o=a(e.fontStyle,s.defaultFontStyle),n=a(e.fontFamily,s.defaultFontFamily);return{size:l,style:o,family:n,font:i.fontString(l,o,n)}},draw:function(e){var a=this,s=[a.options,a.options.subScale,a.options.subScale.subScale];if(s[0].display){var l,o=t.defaults.global,n=[s[0].ticks,s[1].ticks,s[2].ticks],r=[s[0].gridLines,s[1].gridLines,s[2].gridLines],c=[s[0].scaleLabel,s[1].scaleLabel,s[2].scaleLabel],f=a.ctx;n[0].maxTicksLimit&&(l=n[0].maxTicksLimit);var d=[a.parseFontOptions(n[0]),a.parseFontOptions(n[1]),a.parseFontOptions(n[2])],u=r[0].drawTicks?[r[0].tickMarkLength,r[1].drawTicks?r[1].tickMarkLength||.6*r[0].tickMarkLength:0,r[2].drawTicks?r[2].tickMarkLength||.4*r[0].tickMarkLength:0]:[0,0,0],p=[],k=i.getValueOrDefault(c[0].fontColor,o.defaultFontColor),m=a.parseFontOptions(c[0]),g=a.isHorizontal(),h=0!==a.labelRotation,T=i.toRadians(a.labelRotation);if(g){var S=!1;if(n[0].autoSkip){var x=Math.cos(T),v=h?a.longestLabelWidth*x/2:a.longestLabelWidth*x,y=(v+n[0].autoSkipPadding)*a.displayTicks.length,b=a.width-(a.paddingLeft+a.paddingRight);if(y>b&&(S=1+Math.floor(y/b)),l&&a.displayTicks.length>l)for(;!S||a.ticks.length/(S||1)>l;)S||(S=1),S+=1}}if(i.each(a.ticks,function(t,l){if(void 0!==t&&null!==t){var c=a.tickLevels[l];if(s[c].display){var f=a.displayTicks.length===l+1,d=S>1&&l%S>0||l%S===0&&l+S>=a.displayTicks.length;if(!d||f){var k,m,x=i.getValueOrDefault(r[c].borderDash,r[0].borderDash),v=i.getValueOrDefault(r[c].borderDashOffset,r[0].borderDashOffset),y=!!r[0].display&&i.getValueOrDefault(r[c].display,r[0].display),b=!!r[0].drawTicks&&i.getValueOrDefault(r[c].drawTicks,r[0].drawTicks),D=!!r[0].drawOnChartArea&&i.getValueOrDefault(r[c].drawOnChartArea,r[0].drawOnChartArea);if(l===("undefined"!=typeof a.zeroLineIndex?a.zeroLineIndex:0))k=r[0].zeroLineWidth,m=r[0].zeroLineColor;else{var F=i.getValueAtIndexOrDefault(r[0].lineWidth,l),L=i.getValueAtIndexOrDefault(r[c].lineWidth,l,r[0].lineWidth);k=i.isArray(r[0].lineWidth)?F:L;var z=i.getValueAtIndexOrDefault(r[0].color,l),M=i.getValueAtIndexOrDefault(r[c].color,l,r[0].color);m=i.isArray(r[0].color)?z:M}var O,U,w,C,V,I,R,P,Y,A,W=i.getValueOrDefault(n[c].fontColor,o.defaultFontColor),B="middle",X="middle";if(g){"bottom"===s[0].position?(X="top",B=h?"right":"center",A=h?a.top+u[0]:a.top+u[c]):(X="bottom",B=h?"left":"center",A=h?a.bottom-u[0]:a.bottom-u[c]),Y=a.getPixelForTick(l,r[0].offsetGridLines)+n[0].labelOffset;var H=a.getPixelForTick(l)+i.aliasPixel(k),N="bottom"===s[0].position?a.top:a.bottom-u[c],q="bottom"===s[0].position?a.top+u[c]:a.bottom;O=w=V=R=H,U=N,C=q,I=e.top,P=e.bottom}else{var E,G="left"===s[0].position,Q=n[0].padding;n[0].mirror?(B=G?"left":"right",E=Q):(B=G?"right":"left",E=u[c]+Q),Y=G?a.right-E:a.left+E;var _=a.getPixelForTick(l)+i.aliasPixel(k);A=a.getPixelForTick(l,r[0].offsetGridLines);var j="right"===s[0].position?a.left:a.right-u[c],J="right"===s[0].position?a.left+u[c]:a.right;O=j,w=J,V=e.left,R=e.right,U=C=I=P=_}p.push({display:y,level:c,tlDraw:b,tlX1:O,tlY1:U,tlX2:w,tlY2:C,tlColor:r[0].color,glDraw:D,glX1:V,glY1:I,glX2:R,glY2:P,glWidth:k,glColor:m,glBorderDash:x,glBorderDashOffset:v,lDisplay:a.isDisplayTicks[l],lX:Y,lY:A,label:t,lRotation:-1*T,lTextBaseline:X,lTextAlign:B,lFontColor:W})}}}}),i.each(p,function(t){if(t.display&&(f.save(),f.lineWidth=t.glWidth,f.strokeStyle=t.tlColor,f.beginPath(),t.tlDraw&&(f.moveTo(t.tlX1,t.tlY1),f.lineTo(t.tlX2,t.tlY2)),f.stroke(),f.strokeStyle=t.glColor,f.setLineDash&&(f.setLineDash(t.glBorderDash),f.lineDashOffset=t.glBorderDashOffset),t.glDraw&&(f.moveTo(t.glX1,t.glY1),f.lineTo(t.glX2,t.glY2)),f.stroke(),f.restore()),t.lDisplay){f.save(),f.translate(t.lX,t.lY),f.rotate(t.lRotation),f.font=d[t.level].font,f.fillStyle=t.lFontColor,f.textBaseline=t.lTextBaseline,f.textAlign=t.lTextAlign;var e=t.label;if(i.isArray(e))for(var a=0,s=0;a<e.length;++a)f.fillText(""+e[a],0,s),s+=1.5*d[t.level].size;else f.fillText(e,0,0);f.restore()}}),c[0].display){var D,F,L=0;if(g)D=a.left+(a.right-a.left)/2,F="bottom"===s[0].position?a.bottom-m.size/2:a.top+m.size/2;else{var z="left"===s[0].position;D=z?a.left+m.size/2:a.right-m.size/2,F=a.top+(a.bottom-a.top)/2,L=z?-.5*Math.PI:-.5*Math.PI}f.save(),f.translate(D,F),f.rotate(L),f.textAlign="center",f.textBaseline="middle",f.fillStyle=k,f.font=m.font,f.fillText(c[0].labelString,0,0),f.restore()}if(r[0].drawBorder){f.lineWidth=i.getValueAtIndexOrDefault(r[0].lineWidth,0),f.strokeStyle=i.getValueAtIndexOrDefault(r[0].color,0);var M=a.left,O=a.right,U=a.top,w=a.bottom,C=i.aliasPixel(f.lineWidth);g?(U=w="top"===s[0].position?a.bottom:a.top,U+=C,w+=C):(M=O="left"===s[0].position?a.right:a.left,M+=C,O+=C),f.beginPath(),f.moveTo(M,U),f.lineTo(O,w),f.stroke()}}},calculateTickRotation:function(){var t=this,e=t.ctx,a=[t.options.ticks,t.options.subScale.ticks,t.options.subScale.subScale.ticks],s=t.parseFontOptions(a[0]),l=t.labelRotation=a[0].minRotation||0;if(t.options.display){var o=t.displayTicks[0],n=t.displayTicks[1],r=t.displayTicks[t.displayTicks.length-2],c=t.displayTicks[t.displayTicks.length-1];if(t.isHorizontal()){for(var f,d,u=i.longestText(e,s.font,t.displayTicks,t.longestTextCache),p=u,k=t.getPixelForValue(n)-t.getPixelForValue(o)-6,m=t.getPixelForValue(c)-t.getPixelForValue(r)-6,g=Math.min(k,m);p>g&&l<a[0].maxRotation;){var h=i.toRadians(l);if(f=Math.cos(h),d=Math.sin(h),d*u>t.maxHeight){l--;break}l++,p=f*u}t.labelRotation=l;var T;h=i.toRadians(l),f=Math.cos(h),p=f*e.measureText(n).width,void 0!==a[0].min&&k<p&&(T=t.ticks.indexOf(n.toString(10)),t.isDisplayTicks[T]=!1),p=f*e.measureText(c).width,void 0!==a[0].max&&m<p&&(T=t.ticks.indexOf(r.toString(10)),t.isDisplayTicks[T]=!1)}else{var S,x;x=Math.round(1.2*s.size),S=t.getPixelForValue(n)-t.getPixelForValue(o),void 0!==a[0].min&&S<x&&(T=t.ticks.indexOf(n.toString(10)),t.isDisplayTicks[T]=!1),S=t.getPixelForValue(c)-t.getPixelForValue(r),void 0!==a[0].max&&S<x&&(T=t.ticks.indexOf(r.toString(10)),t.isDisplayTicks[T]=!1)}}}}}},{}],3:[function(t,i,e){"use strict";i.exports=function(t){var i=t.helpers,e={position:"left",subScale:{display:!0,ticks:{display:!0,fontSize:11},gridLines:{display:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.07)"},subScale:{display:!0,ticks:{display:!1,fontSize:10},gridLines:{display:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.03)"}}}},a=t.scaleService.getScaleConstructor("linear").extend(t.FineScale),s=a.extend({fineLinear:function(t,e){var a=this,s=[],l=[],o=(t.optsTick,a.niceNum(e.max-e.min,!1)),n=[];n[0]=a.niceNum(o/(t.maxTicks-1),!0),n[1]=a.niceNum(n[0]/10,!0),n[2]=a.niceNum(n[1]/10,!0);var r=2;if(t.stepSize&&t.stepSize>0){for(var c=t.stepSize;(e.max-e.min)/c>1e3;)c*=10;for(var f=c,d=0;d<t.levelMax;d++)n[d]<=c&&(n[d]=f,r=0!==f?d:r,f=0);n[r]=n[r]>c?c:n[r]}var u,p,k=Math.floor(e.min/n[0])*n[0],m=Math.ceil(e.max/n[0])*n[0],g=void 0!==t.min?t.min:k,h=void 0!==t.max?t.max:m,T=function(t){t=0===t?1:t;var e=Math.floor(i.log10(t));return{digits:e>0?0:Math.abs(e),magnification:Math.pow(10,e)}},S=[T(n[0]),T(n[1]),T(n[2])],x=function(t,i,e){var a=t/e%(i[0]/e),s=t/e%(i[1]/e);return 0===a?0:0===s?1:2},v=+((m-k)/n[r]).toFixed(S[r].digits);s.push(g),l.push(x(g,n,S[r].magnification));for(var y=1;y<v;y++)p=k+ +(y*n[r]).toFixed(S[r].digits),p<=g||h<=p||(u=x(p,n,S[r].magnification),s.push(+p.toFixed(S[u].digits)),l.push(u));return s.push(h),l.push(x(h,n,S[r].magnification)),{ticks:s,levels:l,min:g,max:h}},ticksReverse:function(){var t=this;t.ticks.reverse(),t.tickLevels.reverse()},handleDirectionalChanges:function(){var t=this;t.isHorizontal()||t.ticksReverse()},getTickLimit:function(){var e,a=this,s=a.options.ticks;if(a.isHorizontal())e=Math.min(s.maxTicksLimit?s.maxTicksLimit:11,Math.ceil(a.width/50));else{var l=i.getValueOrDefault(s.fontSize,t.defaults.global.defaultFontSize);e=Math.min(s.maxTicksLimit?s.maxTicksLimit:11,Math.ceil(a.height/(1.5*l)))}return Math.max(2,e)},buildTicks:function(){var t=this;t.levelMax=3;var e=t.options,a=[e.ticks,e.subScale.ticks,e.subScale.subScale.ticks],s={maxTicks:t.getTickLimit(),min:a[0].min,max:a[0].max,stepSize:i.getValueOrDefault(a[0].fixedStepSize,a[0].stepSize),optsTick:a,levelMax:t.levelMax},l=t.fineLinear(s,t);t.ticks=l.ticks,t.tickLevels=l.levels,t.max=l.max,t.min=l.min,t.handleDirectionalChanges(),a[0].reverse?(t.ticksReverse(),t.start=t.max,t.end=t.min):(t.start=t.min,t.end=t.max)}});t.scaleService.registerScaleType("fineLinear",s,e)}},{}],4:[function(t,i,e){"use strict";i.exports=function(t){var i={position:"left",ticks:{callback:t.Ticks.formatters.linear},subScale:{display:!0,ticks:{display:!0,fontSize:11},gridLines:{display:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.07)"},subScale:{display:!0,ticks:{display:!1,fontSize:10},gridLines:{display:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.03)"}}}},e=t.scaleService.getScaleConstructor("linear").extend(t.FineScale),a=e;t.scaleService.registerScaleType("fineLinearCompatibilityMode",a,i)}},{}],5:[function(t,i,e){"use strict";i.exports=function(t){var i=t.helpers,e={units:[{name:"millisecond",steps:[1,2,5,10,20,50,100,250,500]},{name:"second",steps:[1,2,5,10,30]},{name:"minute",steps:[1,2,5,10,30]},{name:"hour",steps:[1,2,3,6,12]},{name:"day",steps:[1,2,5]},{name:"week",maxStep:4},{name:"month",maxStep:3},{name:"quarter",maxStep:4},{name:"year",maxStep:!1}]},a={position:"bottom",time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm:ss a",hour:"MMM D, hA",day:"ll",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!1},subScale:{display:!0,ticks:{display:!0,fontSize:11},gridLines:{display:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.07)"},subScale:{display:!0,ticks:{display:!1,fontSize:10},gridLines:{display:!0,drawTicks:!0,color:"rgba(0, 0, 0, 0.03)"}}}},s=t.scaleService.getScaleConstructor("time").extend(t.FineScale),l=s.extend({fineTime:function(t,i){},buildTicks:function(){var a=this;a.ctx.save();var s=i.getValueOrDefault(a.options.ticks.fontSize,t.defaults.global.defaultFontSize),l=i.getValueOrDefault(a.options.ticks.fontStyle,t.defaults.global.defaultFontStyle),o=i.getValueOrDefault(a.options.ticks.fontFamily,t.defaults.global.defaultFontFamily),n=i.fontString(s,l,o);if(a.ctx.font=n,a.ticks=[],a.unitScale=1,a.scaleSizeInUnits=0,a.options.time.unit)a.tickUnit=a.options.time.unit||"day",a.displayFormat=a.options.time.displayFormats[a.tickUnit],a.scaleSizeInUnits=a.lastTick.diff(a.firstTick,a.tickUnit,!0),a.unitScale=i.getValueOrDefault(a.options.time.unitStepSize,1);else{var r=a.isHorizontal()?a.width:a.height,c=a.tickFormatFunction(a.firstTick,0,[]),f=a.ctx.measureText(c).width,d=Math.cos(i.toRadians(a.options.ticks.maxRotation)),u=Math.sin(i.toRadians(a.options.ticks.maxRotation));f=f*d+s*u;var p=r/f;a.tickUnit=a.options.time.minUnit,a.scaleSizeInUnits=a.lastTick.diff(a.firstTick,a.tickUnit,!0),a.displayFormat=a.options.time.displayFormats[a.tickUnit];for(var k=0,m=e.units[k];k<e.units.length;){if(a.unitScale=1,i.isArray(m.steps)&&Math.ceil(a.scaleSizeInUnits/p)<i.max(m.steps)){for(var g=0;g<m.steps.length;++g)if(m.steps[g]>=Math.ceil(a.scaleSizeInUnits/p)){a.unitScale=i.getValueOrDefault(a.options.time.unitStepSize,m.steps[g]);break}break}if(m.maxStep===!1||Math.ceil(a.scaleSizeInUnits/p)<m.maxStep){a.unitScale=i.getValueOrDefault(a.options.time.unitStepSize,Math.ceil(a.scaleSizeInUnits/p));break}++k,m=e.units[k],a.tickUnit=m.name;var h=a.firstTick.diff(a.getMomentStartOf(a.firstTick),a.tickUnit,!0),T=a.getMomentStartOf(a.lastTick.clone().add(1,a.tickUnit)).diff(a.lastTick,a.tickUnit,!0);a.scaleSizeInUnits=a.lastTick.diff(a.firstTick,a.tickUnit,!0)+h+T,a.displayFormat=a.options.time.displayFormats[m.name]}}var S;if(a.options.time.min?S=a.getMomentStartOf(a.firstTick):(a.firstTick=a.getMomentStartOf(a.firstTick),S=a.firstTick),!a.options.time.max){var x=a.getMomentStartOf(a.lastTick),v=x.diff(a.lastTick,a.tickUnit,!0);v<0?a.lastTick=a.getMomentStartOf(a.lastTick.add(1,a.tickUnit)):v>=0&&(a.lastTick=x),a.scaleSizeInUnits=a.lastTick.diff(a.firstTick,a.tickUnit,!0)}a.options.time.displayFormat&&(a.displayFormat=a.options.time.displayFormat),a.ticks.push(a.firstTick.clone());for(var y=1;y<=a.scaleSizeInUnits;++y){var b=S.clone().add(y,a.tickUnit);if(a.options.time.max&&b.diff(a.lastTick,a.tickUnit,!0)>=0)break;y%a.unitScale===0&&a.ticks.push(b)}var D=a.ticks[a.ticks.length-1].diff(a.lastTick,a.tickUnit);0===D&&0!==a.scaleSizeInUnits||(a.options.time.max?(a.ticks.push(a.lastTick.clone()),a.scaleSizeInUnits=a.lastTick.diff(a.ticks[0],a.tickUnit,!0)):(a.ticks.push(a.lastTick.clone()),a.scaleSizeInUnits=a.lastTick.diff(a.firstTick,a.tickUnit,!0))),a.ctx.restore(),a.labelDiffs=void 0}});t.scaleService.registerScaleType("fineTime",l,a)}},{}]},{},[1]);